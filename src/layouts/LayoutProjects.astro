---
import Navbar from "@components/Navbar/Navbar.astro";
import LayoutBase from "./LayoutBase.astro";
import Footer from "@components/Footer.astro";
import ScrollIndicator from "@components/ScrollIndicator.astro";

interface Props {
    title: string;
}

const { title } = Astro.props;
// TODO: use Picture for bg https://docs.astro.build/pl/guides/images/#picture-
// TODO: make sure position of background image is correct
// TODO: change max width
// TODO: for small screens scroll space between hero section disapearing and gallery showing up is too small

// FOR all projects
// TODO: update layout - for small screens look awful - issues
// TODO: use properly sized images
// TODO: issues with images with small text
// TODO: lack of alt for picture link image
// TODO: check if quality of images can be smaller
// TODO: check if there is alt for all picture links
---

<LayoutBase title={title}>
    <div class="after:block after:h-[calc(100vh+20px)] after:w-full after:content-['']">
        <header class="absolute top-0 z-10 h-[calc(100vh+20px)] w-full">
            <Navbar class="absolute z-30 w-full bg-white/10 backdrop-blur-md" />
            <div class="absolute z-10 h-full w-full blur-2xl children:h-full children:w-full" aria-hidden="true">
                <slot name="hero-background-loading" />
            </div>
            <div
                class:list={[
                    "absolute z-20 h-full w-full",
                    "children:h-full children:w-full children:rounded-b-3xl children:object-cover"
                ]}
                data-hero-background
            >
                <slot name="hero-background" />
            </div>
            <ScrollIndicator />
        </header>
        <main class="px-default sticky top-0 mx-auto max-w-[1200px]">
            <div class="flex min-h-screen items-center">
                <div class:list={["my-16 flex h-min flex-col gap-12 text-dark-chocolate", "lg:flex-row lg:gap-7 "]}>
                    <div class:list={["basis-full", "lg:basis-1/3"]}>
                        <div class:list={["mb-4 pt-6 font-metropolis text-2xl uppercase", "lg:mt-6 lg:pt-0"]}>
                            SERVICES
                        </div>
                        <ul class:list={["text-paragraph__normal services-grid", "children:whitespace-nowrap"]}>
                            <slot name="services-list" />
                        </ul>
                    </div>
                    <div class:list={["basis-full", "lg:basis-2/3"]}>
                        <div class="text-header__2">
                            <slot name="project-title" />
                        </div>
                        <div class="text-paragraph__normal children-p-not-last:mb-8">
                            <slot name="project-description" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex min-h-screen place-items-center py-16">
                <div
                    class:list={[
                        "mx-auto grid grid-cols-6 gap-12 children:w-full children:rounded-3xl children:object-cover",
                        "auto-rows-fr children:aspect-square  children:max-w-[580px]",
                        "lg:auto-rows-[350px] lg:gap-3 lg:children:aspect-auto lg:children:h-0 lg:children:min-h-full lg:children:max-w-none"
                    ]}
                >
                    <slot name="images" />
                </div>
            </div>
            {
                Astro.slots.has("quote") ? (
                    <div class="flex min-h-screen flex-col justify-evenly py-16">
                        <slot name="quote" />
                        <div class="ml-8 mt-16 sm:ml-0 sm:self-center">
                            <slot name="link" />
                        </div>
                    </div>
                ) : (
                    <div class="mx-auto w-fit py-40 ">
                        <slot name="link" />
                    </div>
                )
            }
        </main>
    </div>
    <Footer />
</LayoutBase>

<style>
    .services-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, calc(50% - 0.5rem)));
        gap: 1rem;
    }

    [data-hero-background] {
        opacity: 0;
        transition: opacity 250ms ease-in-out;
    }

    [data-hero-background].loaded {
        opacity: 1;
    }
</style>

<script>
    const bgImageContainer = document.querySelector("[data-hero-background]") as HTMLElement;
    const bgImage = bgImageContainer.querySelector("img") as HTMLImageElement;

    function imageLoaded() {
        bgImageContainer.classList.add("loaded");
    }

    if (bgImage.complete) {
        imageLoaded();
    } else {
        bgImage.addEventListener("load", imageLoaded);
    }
</script>
